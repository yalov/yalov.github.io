<div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <h1>
        <a href="{% if site.baseurl == "" %} /{% endif %} {{site.baseurl}}">
          {{ site.title }}
        </a>
      </h1>
        <p class="lead">{{ site.description }}</p>
    </div>

    {% assign all_posts =  '' | split: ',' %}
    {% for collection in site.collections %}  <!--{{collection.label}}-->
      {% assign collection_posts = collection.docs | where: "post_on_sidebar", "true" %}
      {% for post in collection_posts %}
        {% assign all_posts = all_posts | push: post %}
      {% endfor %}
    {% endfor %}

{% assign all_posts_by_category = all_posts | group_by: "category"  | sort: 'name' %}
    <nav class="sidebar-nav">
    {% for category_posts in all_posts_by_category %}  <!--{{collection.label}}-->
      {% unless category_posts.name == '' %}
          <span class="sidebar-nav-item">{{ category_posts.name | remove: '["' | remove: '"]' | split: '", "' | join: ", " | capitalize }}:</span>
      {% for p in category_posts.items %}
      <a class="sidebar-nav-item{% if page.url  == p.url %} active{% endif %}" href="{{site.url}}{{site.baseurl}}{{ p.url }}">{{p.title}}</a>
      {% endfor %}
      {% endunless %}
    {% endfor %}
  </nav>
</div>

  {% assign pages_bottom = site.pages | where: "on_sidebar_bottom", "true" | sort: 'name' %}
  <div class="container sidebar-sticky">
    <nav class="sidebar-nav">
      {% for p in pages_bottom %}
      <a class="sidebar-nav-item{% if page.url  == p.url %} active{% endif %}" href="{{ p.url }}">{{p.title}}</a>{% endfor %}

      <!-- <a class="sidebar-nav-item" href="{{site.url}}{{site.baseurl}}/posts-by-category.html">Categories</a> -->
      <!-- <a class="sidebar-nav-item" href="{{site.url}}{{site.baseurl}}/github-projects.html">GitHub projects </a> -->
    </nav>

    <p>
      <a href="{{ site.github.owner_url }}"><i class="fa fa-github fa-lg" aria-hidden="true"></i></a>
      <a href="mailto:{{site.author.email}}"><i class="fa fa-envelope-o fa-lg" aria-hidden="true"></i></a>
    </p>
    <span style= 'font-size: 0.7em;'>Served by github-pages-gem <a href= "/gem-versions">v{{ site.github.versions.github-pages }}</a></span><br>
    <span>&copy; {{ site.time | date: '%Y' }}, {{site.author.name}}.</span>

  </div>
</div>


<script>
function check() {
  var top = document.getElementsByClassName('container')[0];
  var bottom = document.getElementsByClassName('container sidebar-sticky')[0];
  var sidebar = document.getElementsByClassName('sidebar')[0];

  if (overlaps( top, bottom )) {
    sidebar.innerHTML = sidebar.innerHTML.replace(new RegExp('</div>\\s+<div class="container sidebar-sticky">','m'),'<br><!--overlaps-->');
  }
  else {
    sidebar.innerHTML = sidebar.innerHTML.replace(new RegExp('<br><!--overlaps-->','g'),'</div>\\n<div class="container sidebar-sticky">');
  }
};

check();

$(window).resize(function () {waitForFinalEvent(check, 70, "some unique string");});

</script>
