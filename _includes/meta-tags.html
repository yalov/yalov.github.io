<!-- meta-tags -->

{% capture description %}
	{% if page.summary %}
	  {{ page.summary | strip_html | strip_newlines | strip }}
	{% elsif page.excerpt %}
	  {{ page.excerpt | strip_html | strip_newlines | strip | truncate: 140 }}
	{% else %}
	  {{ site.description }}{% endif %}
{% endcapture %}

{% capture full_url %}
{{page.url | replace:'/index.html','/' | prepend: site.url | prepend: site.baseurl | replace:'//','/' | replace:'//','/' | replace:'https:/','https://'}}
{% endcapture %}

{% capture meta_width %}
{% if page.images.first.width %}
  <meta property="og:image:width" content="{{ page.images.first.width }}" />
{% else %}
  <meta property="og:image:width" content="auto" />
{% endif %}
{% endcapture %}

{% capture meta_height %}
{% if page.images.first.height %}
  <meta property="og:image:height" content="{{ page.images.first.height }}" />
{% else %}
  <meta property="og:image:height" content="auto" />
{% endif %}
{% endcapture %}

<meta name="description" content="{{description | strip}}" />

<link rel="canonical" href="{{full_url | strip}}" />
<link rel="author" href="{{ site.author.name }}" />
<meta property="article:published_time" content="{{page.date | date_to_xmlschema}}" />
<meta property="article:author" content="{{ site.author.name }}" />

<meta property="og:type" content="article" />
<meta property="og:title" content="{{ page.title }}" />
<meta property="og:site_name" content={{site.title}} />
<meta property="og:description" content="{{description | strip}}" />
<meta property="og:url" content="{{full_url | strip}}" />

{% if page.images %}
<meta property="og:image" content="{{ '/images/' | prepend: site.baseurl | prepend: site.url |replace:'//','/'|replace:'//','/' |replace:'https:/','https://' }}{{ page.images.first.name }}" />
{{meta_width | strip}}
{{meta_height | strip}}
{% endif %}


<!-- ld-json (google+)-->
<script type="application/ld+json">
{
  "@context":      "http://schema.org",
  "@type":         "BlogPosting",
  "headline":      "{% if page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}",
  "datePublished": "{{ page.date | date_to_xmlschema }}",
  "dateModified":  "{{ page.date | date_to_xmlschema }}",
  "description":   "{% if page.summary %}{{ page.summary | strip_html | strip_newlines }} {% elsif page.excerpt %}{{ page.excerpt | strip_html | strip_newlines | truncate: 140 }}{% else %}{{ site.description }}{% endif %}",

  "@id":    "{{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url |replace:'//','/'|replace:'//','/' |replace:'https:/','https://'}}",
  "url":    "{{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url |replace:'//','/'|replace:'//','/' |replace:'https:/','https://' }}",

  "mainEntityOfPage": "{{ page.url | replace:'index.html','' | prepend: site.baseurl | prepend: site.url |replace:'//','/'|replace:'//','/' |replace:'https:/','https://' }}",

{% if page.category %}
  "genre":     "{{ page.category }}",
{% endif %}

{% if page.tags %}
  "keywords":  "{{ page.tags | join: ', ' | escape }}",
{% endif %}

{% if page.images %}
{% for image in page.images%}
  "image": {
    "@type":       "ImageObject",
    "image":       "{{ '/images/' | prepend: site.baseurl | prepend: site.url |replace:'//','/'|replace:'//','/' |replace:'https:/','https://' }}{{ image.name }}",
    "description": "{{ image.text }}",
    "name":        "{{ image.name }}",
    "contentUrl":  "{{ '/images/' | prepend: site.baseurl | prepend: site.url |replace:'//','/'|replace:'//','/' |replace:'https:/','https://' }}{{ image.name }}",
    "url":         "{{ '/images/' | prepend: site.baseurl | prepend: site.url |replace:'//','/'|replace:'//','/' |replace:'https:/','https://' }}{{ image.name }}",

    {% if image.width %}     "width":       "{{image.width}}",
    {% else %}               "width":       "auto",
    {% endif %}
    {% if image.height %}    "height":     "{{image.height}}"
    {% else %}               "height":     "auto"
    {% endif %}
  },
  {% endfor %}
{% endif %}

  "author": {
    "@type": "Person",
    "name": "{{ site.author.name }}"
  },

  "publisher": {
    "@type":     "Organization",
    "name":      "{{ site.title}}",
    "logo": {
      "@type":      "ImageObject",
      "contentUrl": "{{'/favicon.png' | prepend: site.baseurl | prepend: site.url |replace:'//','/'|replace:'//','/' |replace:'https:/','https://' }}",
      "url":        "{{'/favicon.png' | prepend: site.baseurl | prepend: site.url |replace:'//','/'|replace:'//','/' |replace:'https:/','https://' }}",
      "width":      16,
      "height":     16
    }
  },

  {% if page.content %}
    "wordCount": "{{ page.content | strip_html | xml_escape | normalize_whitepace | strip_newlines | strip | number_of_words}}"
  {% endif %}
}
</script>

<!-- end meta-tags -->
